---
layout: post
title: ZooKeeper原理
date: 2019-05-08
tags: 后台框架
---

# 分布式要解决的常规问题

> 业务发现（service discovery）

找到分布式系统中存在那些可用的服务和节点

> 名字服务 （name service）

通过给定的名字知道到对应的资源

> 配置管理 （configuration management）

如何在分布式的节点中共享配置文件，保证一致性。

> 故障发现和故障转移 （failure detection and failover）

当某一个节点出故障的时候，如何检测到并通知其它节点， 或者把想用的服务转移到其它的可用节点

> 领导选举（leader election）

如何在众多的节点中选举一个领导者，来协调所有的节点

> 分布式的锁 （distributed exclusive lock）

如何通过锁在分布式的服务中进行同步

> 消息和通知服务 （message queue and notification）

如何在分布式的服务中传递消息，以通知的形式对事件作出主动的响应

# ZooKeeper的用途

Zookeeper本身是一个分布式的应用，通过对共享的数据的管理来实现对分布式应用的协调。  
ZooKeeper通过维护一个树状ZNode图，来同步各种信息，每一个node中存放少量数据（不到1M）。  
每一个node中，可以放的内容，是非常任意的，通常也是需要监控的信息。例如，可以是机器，可以是服务，可以是配置信息等，分别在我们需要监控机器宕机和重启、服务上下线、配置同时同步刷新的情况下使用。如果想要利用ZooKeeper，我们需要保证我们需要监控的服务内部状态信息，是通过Zookeeper来存储的，这样，即使服务挂掉，由于我们还有其他备份服务存在，且我们通过zookeeper的连接，能感知到服务挂掉，这样我们能动态切换客户端连接请求的目标服务。  

总结：ZooKeeper本质做的事情，就是状态数据共享及同步，以及服务发现和状态监控，其他需要重新连接新服务这种事情，都是靠我们的调用方代码手动编写的，zookeeper并没有帮我们实现宕机自动启动其他服务等，而是通过静态的已经确定的服务数，保证某个服务挂掉，也有备份服务替换上去。